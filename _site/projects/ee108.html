<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>FPGA Audio Synthesizer &amp; Visualizer | Carlos Henrique Aranguren</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="FPGA Audio Synthesizer &amp; Visualizer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Robotics, autonomy, and digital systems projects." />
<meta property="og:description" content="Robotics, autonomy, and digital systems projects." />
<link rel="canonical" href="http://localhost:4000/projects/ee108.html" />
<meta property="og:url" content="http://localhost:4000/projects/ee108.html" />
<meta property="og:site_name" content="Carlos Henrique Aranguren" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="FPGA Audio Synthesizer &amp; Visualizer" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Robotics, autonomy, and digital systems projects.","headline":"FPGA Audio Synthesizer &amp; Visualizer","url":"http://localhost:4000/projects/ee108.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Carlos Henrique Aranguren" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Carlos Henrique Aranguren</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/projects/">Projects</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="project-header" style="margin-bottom: 30px;">
  <h1>FPGA Audio Synthesizer &amp; Real-Time Visualizer</h1>
  <p class="subtitle" style="color: #666; font-size: 1.2rem;">A complete hardware audio stack: Wavetable Synthesis, DSP Effects, and VGA Visualization.</p>
  
  <div style="margin-top: 15px;">
    <a href="https://github.com/zackattack160/ee108-lab5" class="btn" style="background: #24292e; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; margin-right: 10px;">View Code on GitHub</a>
    <a href="/assets/documents/ee108-report.pdf" class="btn" style="background: #0366d6; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px;">Download System Report (PDF)</a>
  </div>
</div>

<h2 id="1-system-architecture">1. System Architecture</h2>
<p>This project integrates a digital audio synthesizer with a real-time video oscilloscope. The architecture is split into two clock domains: the Audio Domain (running at 48 kHz) and the Video Domain (running at 100 MHz).</p>

<p><img src="/assets/images/ee108/block-diagram.png" alt="System Overview Block Diagram" />
<em>Figure 1: High-level architecture. The Music Player (Lab 4) generates samples which are fed into the Wave Capture module (Lab 5). A dual-port RAM buffers the data to cross the clock domain to the VGA driver.</em></p>

<hr />

<h2 id="2-the-synthesis-engine-audio-generation">2. The Synthesis Engine (Audio Generation)</h2>
<p>The core of the audio generation is a “Note Player” module that implements <strong>Direct Digital Synthesis (DDS)</strong>. Instead of simply playing back recorded files, the system generates sine waves in real-time by stepping through a lookup table (ROM).</p>

<p><img src="/assets/images/ee108/note-player.png" alt="Note Player Architecture" />
<em>Figure 2: The Note Player datapath. It uses a Frequency ROM to determine the phase increment (step size) for the Sine Reader.</em></p>

<ul>
  <li><strong>Sine Reader:</strong> Uses a 20-bit accumulator to step through a 1024-entry Sine ROM. To save memory, we only stored one quadrant of the sine wave and used logic to flip/mirror the output for the other three quadrants.</li>
  <li><strong>Frequency Precision:</strong> We used fixed-point arithmetic (10.10 format) for the step size to ensure precise pitch accuracy, preventing the audio from sounding detuned over time.</li>
</ul>

<hr />

<h2 id="3-the-visualization-engine-vga-oscilloscope">3. The Visualization Engine (VGA Oscilloscope)</h2>
<p>The major engineering challenge was bridging the <strong>Audio Domain (48 kHz)</strong> and the <strong>Video Domain (100 MHz)</strong>. To prevent visual tearing and metastability, I implemented a “Ping-Pong” buffer scheme.</p>

<h3 id="control-logic-fsm">Control Logic (FSM)</h3>
<p>The visualization is controlled by a finite state machine that triggers data capture only when the audio signal crosses from negative to positive (Zero-Crossing Detection). This ensures the waveform remains stable on the screen.</p>

<p><img src="/assets/images/ee108/wave-capture-fsm.png" alt="Capture FSM" />
<em>Figure 3: The Wave Capture FSM. It transitions from ‘Armed’ to ‘Active’ only upon detecting a zero-crossing event.</em></p>

<ul>
  <li><strong>Armed State:</strong> Waits for the signal to cross zero.</li>
  <li><strong>Active State:</strong> Captures 256 samples into the Write Buffer.</li>
  <li><strong>Wait State:</strong> Holds until the VGA display finishes its current frame before swapping buffers.</li>
</ul>

<hr />

<h2 id="4-verification--simulation">4. Verification &amp; Simulation</h2>
<p>Before synthesis, the design was verified using ModelSim. Below is the waveform simulation for the <code class="language-plaintext highlighter-rouge">wave_capture</code> module, confirming that the <code class="language-plaintext highlighter-rouge">write_enable</code> signal asserts exactly when the audio sample transitions.</p>

<p><img src="/assets/images/ee108/waveforms.png" alt="Simulation Waveforms" />
<em>Figure 4: ModelSim results showing the FSM triggering capture (write_enable high) immediately after a zero-crossing event.</em></p>

<hr />

<h2 id="5-final-project-extensions-polyphony--dsp">5. Final Project Extensions: Polyphony &amp; DSP</h2>
<p>For the final iteration, we extended the architecture to support advanced audio features.</p>

<h3 id="polyphonic-synthesis">Polyphonic Synthesis</h3>
<p>The base system could only play one note at a time. We upgraded the <code class="language-plaintext highlighter-rouge">Note Player</code> to support <strong>chords (up to 23 simultaneous notes)</strong>.</p>
<ul>
  <li><strong>Implementation:</strong> The system iterates through active notes within a single 48kHz audio frame, accumulating their sample values.</li>
  <li><strong>Saturation Logic:</strong> To prevent integer overflow (which causes harsh digital clipping), we implemented a custom saturation adder that clamps the signal at the 16-bit maximum (<code class="language-plaintext highlighter-rouge">16'h7FFF</code>).</li>
</ul>

<h3 id="hardware-echo-effect">Hardware Echo Effect</h3>
<p>We built a real-time delay line using a circular buffer in BRAM.</p>

<div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center;">
  <img src="/assets/images/ee108/echoblock1.png" alt="Echo Addressing" style="width: 48%; min-width: 300px;" />
  <img src="/assets/images/ee108/echoblock2.png" alt="Echo Processing" style="width: 48%; min-width: 300px;" />
</div>
<p><em>Figure 5: The Echo effect architecture (Memory Addressing &amp; Signal Processing). It mixes the dry signal with a delayed, attenuated “wet” signal.</em></p>

<ul>
  <li><strong>Circular Buffering:</strong> The read pointer trails the write pointer by a user-defined <code class="language-plaintext highlighter-rouge">delay_samples</code> offset.</li>
  <li><strong>Bitwise Attenuation:</strong> Instead of expensive hardware multipliers, we used arithmetic right shifts (<code class="language-plaintext highlighter-rouge">&gt;&gt;&gt;</code>) to decay the echo volume (e.g., shifting by 1 reduces volume by 50%).</li>
</ul>

<hr />

<h2 id="6-implementation-results">6. Implementation Results</h2>
<p>The final design was synthesized and routed successfully on the Zynq-7000 FPGA.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Metric</th>
      <th style="text-align: left">Result</th>
      <th style="text-align: left">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Worst Negative Slack</strong></td>
      <td style="text-align: left">+1.289ns</td>
      <td style="text-align: left">Met 100MHz timing constraints</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Critical Path</strong></td>
      <td style="text-align: left">7 Logic Levels</td>
      <td style="text-align: left">Located in the VGA pixel validation logic</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>BRAM Usage</strong></td>
      <td style="text-align: left">&lt; 5%</td>
      <td style="text-align: left">Efficient use of memory for lookups &amp; buffers</td>
    </tr>
  </tbody>
</table>

<p><br /></p>
<p style="text-align: center; font-style: italic;">
  <a href="https://github.com/zackattack160/ee108-lab5">View the full Verilog source code on GitHub.</a>
</p>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Carlos Henrique Aranguren</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Carlos Henrique Aranguren</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Robotics, autonomy, and digital systems projects.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
